services:

  # open5gs
  core:
    container_name: "core"
    image: cell-docker-core
    command: ./initRoaming.sh
    env_file: ".env"
    build:
      dockerfile: core.Dockerfile
      context: ./docker
      network: host
    privileged: true
    network_mode: "host"
    cap_add:
      - SYS_NICE
      - NET_ADMIN
      - SYS_ADMIN
    ulimits:
      rtprio: 99
      rttime: -1
      memlock: 8428281856
    healthcheck:
      test: ["CMD-SHELL", "grep -q 'Running 5G SA Core Network' ./health.log"]
      interval: 5s
    volumes:
      - type: bind
        source: /open5gs/
        target: /open5gs/
        read_only: false
      - /dev/:/dev/
      - /proc:/proc
    tty: true
  
  # srsran gnb
  gnb:
    container_name: gnb
    image: cell-docker-gnb
    command: ./initGnb.sh
    env_file: ".env"
    environment:
      CONTAINER_NAME: "gnb"
    build:
      dockerfile: gnb.Dockerfile
      context: ./docker
      network: host
    privileged: true
    network_mode: "host"
    cap_add:
      - SYS_NICE
      - NET_ADMIN
      - SYS_ADMIN
    ulimits:
      rtprio: 99
      rttime: -1
      memlock: 8428281856
    volumes:
      - /tmp/gnb/:/tmp/
      - /dev/:/dev/
      - /proc:/proc
    depends_on:
      core:
        condition: service_healthy
        restart: true
    stdin_open: true
    tty: true